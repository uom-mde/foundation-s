<?php 
$siteSettingService = $this->getHelperPluginManager()->get('siteSetting');

// Initialize arrays
$externalSites = [];
$librarySites = [];

foreach ($sites as $site) {
    $category = $siteSettingService('extended_site_description_categories', null, $site->id());

    if ($category === 'External') {
        $externalSites[] = $site;
    } elseif ($category === 'Library') {
        $librarySites[] = $site;
    }
}
?>

<div class="list-of-sites">
    <div class="site-list">
        <?php
        foreach ($sites as $site):
            $featured = $siteSettingService('extended_site_description_featured', null, $site->id());

            if ($featured):
                echo $this->partial('common/site-list-entry', [
                    'site' => $site,
                    'showSummary' => $summaries,
                    'showThumbnail' => $thumbnails
                ]);
            endif;
        endforeach;
        ?>
    </div>

    <h2>External Sites</h2>
    <div class="list-of-sites">
    <div class="site-list">
        <?php foreach ($externalSites as $site): ?>
            <?php echo $this->partial('common/site-list-entry', ['site' => $site]); ?>
        <?php endforeach; ?>

        <?php
        foreach ($externalSites as $site):
                echo $this->partial('common/site-list-entry', [
                    'site' => $site,
                    'showSummary' => $summaries,
                    'showThumbnail' => $thumbnails
                ]);
        endforeach;
        ?>
        </div>
    </div>

    <h2>Library Sites</h2>
    <div class="list-of-sites">
    <div class="site-list">
    <?php
        foreach ($librarySites as $site):
                echo $this->partial('common/site-list-entry', [
                    'site' => $site,
                    'showSummary' => $summaries,
                    'showThumbnail' => $thumbnails
                ]);
        endforeach;
        ?>
        </div>
    </div>

    <?php if ($pagination): ?>
        <?php echo $this->pagination(); ?>
    <?php endif; ?>
</div>
