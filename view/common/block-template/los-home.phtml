<?php
$api = $this->api();
?>

<?php foreach ($sites as $site): ?>
    <?php
    // Try fetching the site's locale from site settings
    try {
        $siteSettings = $api->read('site_settings', ['site_id' => $site->id()])->getContent();
        $siteLocale = $siteSettings['locale'] ?? 'en'; // Default to 'en' if not set
    } catch (Exception $e) {
        $siteLocale = 'en'; // If the API call fails, default to English
    }
    ?>

    <?php if ($siteLocale === 'en'): ?>
        <?php
        $thumbnail = $thumbnails ? $site->thumbnail() : null;
        $summary = $summaries ? $site->summary() : null;
        ?>
        <div class="site card">
            <div class="card-divider">
                <?php echo $this->hyperlink($site->title(), $site->siteUrl(), ['class' => 'site-link']); ?>
            </div>

            <?php if ($thumbnail): ?>
                <div class="site-thumbnail"><?php echo $this->thumbnail($thumbnail, 'square', ['class' => 'site-thumbnail-image']); ?></div>
            <?php endif; ?>

            <?php if ($summary): ?>
                <div class="site-summary card-section"><?php echo nl2br($this->escapeHtml($summary)); ?></div>
            <?php endif; ?>
        </div>
    <?php endif; ?>
<?php endforeach; ?>