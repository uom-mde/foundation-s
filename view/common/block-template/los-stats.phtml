<?php
// Get full API endpoint for API Info module
$infoUrl = 'http://localhost/omeka-s/api/infos';
$siteUrl = 'http://localhost/omeka-s/api/infos/sites';

function getInfo($url) {
    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

    // OPTIONAL for testing:
    // curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
    // curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);

    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);

    if (curl_errno($ch)) {
        echo '<p>cURL error: ' . curl_error($ch) . '</p>';
        return [];
    }

    if ($httpCode !== 200) {
        echo "<p>API request failed with status: $httpCode</p>";
        return [];
    }

    curl_close($ch);
    return json_decode($response, true);
}

$info = getInfo($infoUrl);
$totalItems = $info['items']['total'] ?? 'N/A';
$totalMedia = $info['media']['total'] ?? 'N/A';
$totalItemSets = $info['item_sets']['total'] ?? 'N/A';

$siteInfo = getInfo($siteUrl);
$totalSites = $siteInfo['total'] ?? 'N/A';
$totalPages = $siteInfo['pages'] ?? 'N/A';
?>

<div class="full-width mde-stats dark-background">
    <div class="grid-container">
        <dl>
            <dt class="h2">Exhibitions</dt>
            <dd class="h1"><?php echo htmlspecialchars($totalSites); ?></dd>
            <dt class="h2">Pages</dt>
            <dd class="h1"><?php echo htmlspecialchars($totalPages); ?></dd>
            <dt class="h2">Items</dt>
            <dd class="h1"><?php echo htmlspecialchars($totalItems); ?></dd>
            <dt class="h2">Media</dt>
            <dd class="h1"><?php echo htmlspecialchars($totalMedia); ?></dd>
        </dl>
    </div>
</div>