<?php
$hyperlink = $this->plugin('hyperlink');
$thumbnailType = $block->dataValue('thumbnail_type');
?>
<?php
$hyperlink     = $this->plugin('hyperlink');
$thumbnailType = $block->dataValue('thumbnail_type');
?>
<div class="reveal-on-scroll lazy-fade-in">
  <div class="full-width file-caption-block media-caption-text resourceTextGrid
              padding-horizontal-1 large-padding-2 margin-vertical-1 large-margin-vertical-2">
    <div class="file file-caption-text media-embed large-padding-horizontal-1
                <?= $this->escapeHtml(implode(' ', $classes)); ?>">
      <?php foreach ($attachments as $attachment): 
        $item  = $attachment->item();
        $media = $attachment->media() ?: $item->primaryMedia();
        if (! $media) {
            continue;
        }

        // Determine the URL for the thumbnail or media render:
        if ($mediaDisplay === 'thumbnail') {
            switch ($link) {
                case 'original':
                    $url      = $media->originalUrl();
                    $imgUrl   = $media->originalUrl();
                    break;
                case 'item':
                    $url      = $item->url();
                    $imgUrl   = $media->originalUrl();
                    break;
                case 'media':
                    $url      = $media->url();
                    $imgUrl   = $media->originalUrl();
                    break;
                default:
                    throw new \InvalidArgumentException(sprintf(
                        'Invalid link type "%s"', 
                        $link
                    ));
            }
            // For true lazyâ€‘load, output an <img> with data-src:
            $imgTag = sprintf(
                '<img class="lazy-image" data-src="%s" alt="%s">',
                $this->escapeHtmlAttr($this->thumbnail($media, $thumbnailType, ['full'])['src']),
                $this->escapeHtmlAttr($media->altText() ?: $item->displayTitle())
            );
            // Wrap in the hyperlink (you can also do loading="lazy" here as fallback):
            echo $hyperlink->raw($imgTag, $url);

        } else {
            // For other media types (video, embed), render a placeholder iframe or video tag:
            $embedUrl = $media->url();
            echo '<div class="lazy-embed" data-src="' 
                 . $this->escapeHtmlAttr($embedUrl) 
                 . '"></div>';
        }
      endforeach; ?>
    </div>
  </div>
</div>  <!-- End of reveal-on-scroll -->