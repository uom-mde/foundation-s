<?php
$hyperlink     = $this->plugin('hyperlink');
$thumbnailType = $block->dataValue('thumbnail_type');
?>
<div class="reveal-on-scroll lazy-fade-in">
  <div class="full-width file-caption-block media-caption-text resourceTextGrid
              padding-horizontal-1 large-padding-2 margin-vertical-1 large-margin-vertical-2">
    <div class="file file-caption-text media-embed large-padding-horizontal-1
                <?= $this->escapeHtml(implode(' ', $classes)); ?>">
      <?php foreach ($attachments as $attachment): 
        $item  = $attachment->item();
        $media = $attachment->media() ?: $item->primaryMedia();
        if (! $media) {
            continue;
        }

        // Always output an <img> or <iframe> with data-src,
        // regardless of mediaDisplay or link type:

        $urlToLoad = ($mediaDisplay === 'thumbnail')
            ? $this->thumbnail($media, $thumbnailType, ['full'])['src']
            : $media->url();

        // For images:
        echo '<img class="lazy-media" '
           . 'data-src="' . $this->escapeHtmlAttr($urlToLoad) . '" '
           . 'alt="' . $this->escapeHtmlAttr($media->altText() ?: '') . '">';

      endforeach; ?>
    </div>
  </div>
</div>
